workflows:
  ios-release:
    name: "SLM iOS"
    environment:
      flutter: stable
      xcode: latest
    scripts:
      - name: ðŸ§¹ Clean & Fetch Packages
        script: |
          flutter clean
          flutter pub get

      - name: ðŸ“Œ Generate Podfile if not existing
        script: |
          if [ ! -f ios/Podfile ]; then
            flutter build ios --no-codesign
          fi

      - name: âœ… Set minimum iOS version 14.0
        script: |
          echo "ðŸ”§ Updating Podfile to iOS 14.0"
          sed -i '' 's/platform :ios.*/platform :ios, '\''14.0'\''/' ios/Podfile || echo "platform :ios, '14.0'" >> ios/Podfile

      - name: ðŸ“¦ Install pods
        script: |
          cd ios
          rm -rf Pods Podfile.lock
          pod install
          cd ..

      - name: ðŸš€ Build IPA
        script: |
          flutter build ipa --no-codesign

    artifacts:
      - build/ios/ipa/*.ipa
